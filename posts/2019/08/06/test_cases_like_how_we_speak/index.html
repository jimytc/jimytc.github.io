<!doctype html><html lang=en><head><link href=https://gmpg.org/xfn/11 rel=profile><link rel=canonical href=https://jimytc.com/posts/2019/08/06/test_cases_like_how_we_speak/><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.114.1"><title>Test Cases Like How We Speak • Jim Chen</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Test Cases Like How We Speak"><meta name=twitter:description content="In my current software development work, we&rsquo;ve talked about TDD within the team but we haven&rsquo;t really apply this process for couple reasons. But we do care about the products we shipped."><meta property="og:title" content="Test Cases Like How We Speak"><meta property="og:description" content="In my current software development work, we&rsquo;ve talked about TDD within the team but we haven&rsquo;t really apply this process for couple reasons. But we do care about the products we shipped."><meta property="og:type" content="article"><meta property="og:url" content="https://jimytc.com/posts/2019/08/06/test_cases_like_how_we_speak/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-06T09:12:13+08:00"><meta property="article:modified_time" content="2019-08-06T09:12:13+08:00"><meta property="og:site_name" content="Backend Engineer"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github.min.css><link rel=stylesheet href=/scss/hyde-hyde.3081c4981fb69a2783dd36ecfdd0e6ba7a158d4cbfdd290ebce8f78ba0469fc6.css integrity="sha256-MIHEmB+2mieD3Tbs/dDmunoVjUy/3SkOvOj3i6BGn8Y="><link rel=stylesheet href=/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body class=theme-base-0a><div class=sidebar><div class=container><div class=sidebar-about><span class=site__title><a href=https://jimytc.com/>Jim Chen</a></span><div class=author-image><img src=https://jimytc.com/images/author-photo.png alt="Author Image" class="img--circle img--headshot element--center"></div><p class=site__description>a.k.a. jimytc</p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>Jim Chen</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=/posts/><span>Posts</span></a></li><li><a href=/tags/><span>Tags</span></a></li><li><a href=/categories/><span>Categories</span></a></li></ul></div><section class=social><a href=https://twitter.com/jimytc rel=me><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a>
<a href=https://facebook.com/jim.yenting rel=me><i class="fab fa-facebook-f"></i></a>
<a href=https://github.com/jimytc rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a>
<a href=https://instagram.com/jimytc rel=me><i class="fab fa-instagram fa-lg" aria-hidden=true></i></a>
<a href=https://linkedin.com/in/yentingchen rel=me><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a>
<a href=https://stackoverflow.com/users/2728942/jimytc rel=me><i class="fab fa-stack-overflow fa-lg" aria-hidden=true></i></a></section></div></div><div class=copyright>&copy; 2023 jimytc
<a href=https://creativecommons.org/licenses/by-sa/4.0>CC BY-SA 4.0</a></div><div class=builtwith>Built with <a href=https://gohugo.io>Hugo</a> ❤️ <a href=https://github.com/htr3n/hyde-hyde>hyde-hyde</a>.</div></div></div><div class="content container"><article><header><h1>Test Cases Like How We Speak</h1><div class=post__meta><i class="fas fa-calendar-alt"></i> Aug 6, 2019
in
<a class="badge badge-category" href=/categories/engineering>ENGINEERING</a><br><i class="fas fa-tags"></i>
<a class="badge badge-tag" href=/tags/ruby>ruby</a>
<a class="badge badge-tag" href=/tags/agile-development>agile development</a>
<a class="badge badge-tag" href=/tags/unit-test>unit test</a>
<a class="badge badge-tag" href=/tags/tdd>tdd</a>
<a class="badge badge-tag" href=/tags/test-driven-development>test driven development</a><br><i class="fas fa-clock"></i> 3 min read</div></header><div class=post><p>In my current software development work, we&rsquo;ve talked about <a href=https://en.wikipedia.org/wiki/Test-driven_development>TDD</a> within the team but we haven&rsquo;t really apply this process for couple reasons. But we do care about the products we shipped. So we all committed to the principle which is we should always write tests for the production code.</p><h2 id=typical-cases>Typical cases</h2><p>Writing test cases is a way to communicate with your current and the future team members. Even more, it&rsquo;s a way to communicate with PMs or POs that the engineering artifact can satisfy the requirements and scenarios from stakeholders. Therefore, making test cases readable is important.</p><p>Test case always cover the following parts, inputs, testing condition, function execution and result verification. The following snippet is a typical test cases we have. There&rsquo;s a bunch of similar codes. Even more, they are just duplicates.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BudgetServiceTest</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>setup</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>
</span></span><span style=display:flex><span>    @budget_repo <span style=color:#f92672>=</span> <span style=color:#66d9ef>BudgetRepo</span><span style=color:#f92672>.</span>new
</span></span><span style=display:flex><span>    @budget_service <span style=color:#f92672>=</span> <span style=color:#66d9ef>BudgetService</span><span style=color:#f92672>.</span>new(@budget_repo)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  test <span style=color:#e6db74>&#39;no budget&#39;</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    stub(@budget_repo)<span style=color:#f92672>.</span>all_budgets { <span style=color:#f92672>[]</span> }
</span></span><span style=display:flex><span>    start_date <span style=color:#f92672>=</span> <span style=color:#66d9ef>Date</span><span style=color:#f92672>.</span>strptime(<span style=color:#e6db74>&#39;20190401&#39;</span>, <span style=color:#e6db74>&#39;%Y%m%d&#39;</span>)
</span></span><span style=display:flex><span>    end_date <span style=color:#f92672>=</span> <span style=color:#66d9ef>Date</span><span style=color:#f92672>.</span>strptime(<span style=color:#e6db74>&#39;20190401&#39;</span>, <span style=color:#e6db74>&#39;%Y%m%d&#39;</span>)
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> @budget_service<span style=color:#f92672>.</span>query(start_date, end_date)
</span></span><span style=display:flex><span>    assert_equal <span style=color:#ae81ff>0</span>, result
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  test <span style=color:#e6db74>&#39;period not in budget month&#39;</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    budgets <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>Budget</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;201904&#39;</span>, <span style=color:#ae81ff>30</span>), <span style=color:#66d9ef>Budget</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;201905&#39;</span>, <span style=color:#ae81ff>310</span>)<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    stub(@budget_repo)<span style=color:#f92672>.</span>all_budgets { budgets }
</span></span><span style=display:flex><span>    start_date <span style=color:#f92672>=</span> <span style=color:#66d9ef>Date</span><span style=color:#f92672>.</span>strptime(<span style=color:#e6db74>&#39;20190301&#39;</span>, <span style=color:#e6db74>&#39;%Y%m%d&#39;</span>)
</span></span><span style=display:flex><span>    end_date <span style=color:#f92672>=</span> <span style=color:#66d9ef>Date</span><span style=color:#f92672>.</span>strptime(<span style=color:#e6db74>&#39;20190301&#39;</span>, <span style=color:#e6db74>&#39;%Y%m%d&#39;</span>)
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> @budget_service<span style=color:#f92672>.</span>query(start_date, end_date)
</span></span><span style=display:flex><span>    assert_equal <span style=color:#ae81ff>0</span>, result
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  test <span style=color:#e6db74>&#39;period inside budget month&#39;</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    budgets <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>Budget</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;201904&#39;</span>, <span style=color:#ae81ff>30</span>), <span style=color:#66d9ef>Budget</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;201905&#39;</span>, <span style=color:#ae81ff>310</span>)<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    stub(@budget_repo)<span style=color:#f92672>.</span>all_budgets { budgets }
</span></span><span style=display:flex><span>    start_date <span style=color:#f92672>=</span> <span style=color:#66d9ef>Date</span><span style=color:#f92672>.</span>strptime(<span style=color:#e6db74>&#39;20190401&#39;</span>, <span style=color:#e6db74>&#39;%Y%m%d&#39;</span>)
</span></span><span style=display:flex><span>    end_date <span style=color:#f92672>=</span> <span style=color:#66d9ef>Date</span><span style=color:#f92672>.</span>strptime(<span style=color:#e6db74>&#39;20190401&#39;</span>, <span style=color:#e6db74>&#39;%Y%m%d&#39;</span>)
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> @budget_service<span style=color:#f92672>.</span>query(start_date, end_date)
</span></span><span style=display:flex><span>    assert_equal <span style=color:#ae81ff>1</span>, result
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>To make this chunks more structured, we usually move some of them into a private methods. For example, extract data preparation to another method and extract function execution to another method. Each test cases then can be more clear.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  test <span style=color:#e6db74>&#39;period inside budget month&#39;</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    prepare_budgets
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> query_result(<span style=color:#e6db74>&#39;20190401&#39;</span>, <span style=color:#e6db74>&#39;20190401&#39;</span>)
</span></span><span style=display:flex><span>    assert_equal <span style=color:#ae81ff>1</span>, result
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>prepare_budgets</span>
</span></span><span style=display:flex><span>    budgets <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>Budget</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;201904&#39;</span>, <span style=color:#ae81ff>30</span>), <span style=color:#66d9ef>Budget</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;201905&#39;</span>, <span style=color:#ae81ff>310</span>)<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    stub(@budget_repo)<span style=color:#f92672>.</span>all_budgets { budgets }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>query_result</span>(start_date_str, end_date_str)
</span></span><span style=display:flex><span>    start_date <span style=color:#f92672>=</span> <span style=color:#66d9ef>Date</span><span style=color:#f92672>.</span>strptime(start_date_str, <span style=color:#e6db74>&#39;%Y%m%d&#39;</span>)
</span></span><span style=display:flex><span>    end_date <span style=color:#f92672>=</span> <span style=color:#66d9ef>Date</span><span style=color:#f92672>.</span>strptime(end_date_str, <span style=color:#e6db74>&#39;%Y%m%d&#39;</span>)
</span></span><span style=display:flex><span>    @budget_service<span style=color:#f92672>.</span>query(start_date, end_date)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span></code></pre></div><p>Actually, this is already fine but maybe we would like to have more flexibility on what data is prepared or what query condition is defined. Further, those thing were under a certain scope.</p><h2 id=more-descriptive-by-leveraging-on-language-feature>More descriptive by leveraging on language feature</h2><p>There&rsquo;s a testing framework called <a href=https://rspec.info/><code>rspec</code></a> which provides this flexibility. However, what if the existing code base does not use it? In Ruby, it&rsquo;s actually pretty simple to achieve almost the same thing by use fundamental elements, block and its invocation. Here&rsquo;s updated example.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  test <span style=color:#e6db74>&#39;period inside budget month&#39;</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    given_budgets <span style=color:#66d9ef>Budget</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;201904&#39;</span>, <span style=color:#ae81ff>30</span>), <span style=color:#66d9ef>Budget</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;201905&#39;</span>, <span style=color:#ae81ff>310</span>) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      when_period from(<span style=color:#e6db74>&#39;20190401&#39;</span>), to(<span style=color:#e6db74>&#39;20190401&#39;</span>) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        result_should_be <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>given_budgets</span>(<span style=color:#f92672>*</span>budgets)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> block_given?
</span></span><span style=display:flex><span>      stub(@budget_repo)<span style=color:#f92672>.</span>all_budgets { budgets }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>yield</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>with_period</span>(from, to)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> block_given?
</span></span><span style=display:flex><span>      assertion_block <span style=color:#f92672>=</span> <span style=color:#66d9ef>yield</span>
</span></span><span style=display:flex><span>      actual <span style=color:#f92672>=</span> @budget_service<span style=color:#f92672>.</span>query(from, to)
</span></span><span style=display:flex><span>      assertion_block<span style=color:#f92672>.</span>call(actual)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>result_should_be</span>(expected)
</span></span><span style=display:flex><span>    <span style=color:#f92672>-&gt;</span> (actual) { assert_equal expected, actual }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>from</span>(date_str)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Date</span><span style=color:#f92672>.</span>strptime(date_str, <span style=color:#e6db74>&#39;%Y%m%d&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to</span>(date_str)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Date</span><span style=color:#f92672>.</span>strptime(date_str, <span style=color:#e6db74>&#39;%Y%m%d&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span></code></pre></div><h2 id=references>References</h2><p><a href=https://en.wikipedia.org/wiki/Test-driven_development>Test Driven Development</a></p><p><a href=https://en.wikipedia.org/wiki/Test_case>Test Case</a></p></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="jimytc-github-io",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the
<a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by
<span class=logo-disqus>Disqus</span></a></article></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-NRN7ZQM9J2"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NRN7ZQM9J2",{anonymize_ip:!1})}</script><script defer src=https://use.fontawesome.com/releases/v5.12.1/js/all.js integrity=sha384-ZbbbT1gw3joYkKRqh0kWyRp32UAvdqkpbLedQJSlnI8iLQcFVxaGyrOgOJiDQTTR crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js></script>
<script type=text/javascript>hljs.initHighlightingOnLoad()</script></body></html>