<!doctype html><html lang=en><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="public"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.64.1"><title>[閱讀筆記] 單元測試的藝術 Part I • Jim Chen</title><meta name=twitter:card content="summary"><meta name=twitter:title content="[閱讀筆記] 單元測試的藝術 Part I"><meta name=twitter:description content="單元測試的藝術 - 入門篇 (Ch1 & Ch2) 定義們 被測試系統 SUT（System Under Test）  被測試程式所測試的對象，可以是函數，可以是類別，可以是一個複雜的元件，也可以是一個軟體。 一般來說
 工作單元、使用案例 Use Case  從呼叫系統的一個公開方法，到產生一個測試可見最終結果，在期間這個系統所發生的行為統稱為一個工作單元。
 可見的最終結果可以是
 回傳值（如果公開方法有回傳值的話） 系統可見的狀態或行為改變，不需要查詢私有狀態就能取得。 呼叫一個不受測試所控制的第三方系統，這個第三方系統不回傳任何值或者回傳值不被系統使用。  單元測試 Unit Test  一個單元測試是一段自動化的程式碼，這段程式會呼叫被測試的工作單元，之後對這個單元的最終結果的某些假設或期望進行驗證。"><meta property="og:title" content="[閱讀筆記] 單元測試的藝術 Part I"><meta property="og:description" content="單元測試的藝術 - 入門篇 (Ch1 & Ch2) 定義們 被測試系統 SUT（System Under Test）  被測試程式所測試的對象，可以是函數，可以是類別，可以是一個複雜的元件，也可以是一個軟體。 一般來說
 工作單元、使用案例 Use Case  從呼叫系統的一個公開方法，到產生一個測試可見最終結果，在期間這個系統所發生的行為統稱為一個工作單元。
 可見的最終結果可以是
 回傳值（如果公開方法有回傳值的話） 系統可見的狀態或行為改變，不需要查詢私有狀態就能取得。 呼叫一個不受測試所控制的第三方系統，這個第三方系統不回傳任何值或者回傳值不被系統使用。  單元測試 Unit Test  一個單元測試是一段自動化的程式碼，這段程式會呼叫被測試的工作單元，之後對這個單元的最終結果的某些假設或期望進行驗證。"><meta property="og:type" content="article"><meta property="og:url" content="https://jimytc.com/posts/2020/02/23/reading_notes_unit_testing_part_one/"><meta property="article:published_time" content="2020-02-23T23:58:24+08:00"><meta property="article:modified_time" content="2020-02-23T23:58:24+08:00"><meta property="og:site_name" content="Backend Engineer"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css><link rel=stylesheet href=/scss/hyde-hyde.92c66d107d7b219f0792cfd67223179af884b03f386ac46894f9f735932bbca3.css integrity="sha256-ksZtEH17IZ8Hks/WciMXmviEsD84asRolPn3NZMrvKM="><link rel=stylesheet href=/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body class=theme-base-0a><div class=sidebar><div class=container><div class=sidebar-about><span class=site__title><a href=https://jimytc.com/>Jim Chen</a></span><div class=author-image><img src=https://jimytc.com/images/author-photo.png alt="Author Image" class="img--circle img--headshot element--center"></div><p class=site__description>a.k.a. jimytc</p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>Jim Chen</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=/posts/><span>Posts</span></a></li><li><a href=/tags/><span>Tags</span></a></li><li><a href=/categories/><span>Categories</span></a></li></ul></div><section class=social><a href=https://twitter.com/jimytc rel=me><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a><a href=https://facebook.com/jim.yenting rel=me><i class="fab fa-facebook-f"></i></a><a href=https://github.com/jimytc rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a><a href=https://instagram.com/jimytc rel=me><i class="fab fa-instagram fa-lg" aria-hidden=true></i></a><a href=https://linkedin.com/in/yentingchen rel=me><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a><a href=https://stackoverflow.com/users/2728942/jimytc rel=me><i class="fab fa-stack-overflow fa-lg" aria-hidden=true></i></a></section></div></div><div class=copyright>&copy; 2022 jimytc
<a href=https://creativecommons.org/licenses/by-sa/4.0>CC BY-SA 4.0</a></div><div class=builtwith>Built with <a href=https://gohugo.io>Hugo</a> ❤️ <a href=https://github.com/htr3n/hyde-hyde>hyde-hyde</a>.</div></div></div><div class="content container"><article><header><h1>[閱讀筆記] 單元測試的藝術 Part I</h1><div class=post__meta><i class="fas fa-calendar-alt"></i>Feb 23, 2020
in
<a class="badge badge-category" href=/categories/engineering>ENGINEERING</a><br><i class="fas fa-tags"></i><a class="badge badge-tag" href=/tags/testing>testing</a>
<a class="badge badge-tag" href=/tags/unit-testing>unit testing</a>
<a class="badge badge-tag" href=/tags/%E9%96%B1%E8%AE%80%E7%AD%86%E8%A8%98>閱讀筆記</a><br><i class="fas fa-clock"></i>1 min read</div></header><div class=post><h1 id=單元測試的藝術---入門篇-ch1--ch2>單元測試的藝術 - 入門篇 (Ch1 & Ch2)</h1><h2 id=定義們>定義們</h2><h3 id=被測試系統-sutsystem-under-test>被測試系統 SUT（System Under Test）</h3><blockquote><p>被測試程式所測試的對象，可以是函數，可以是類別，可以是一個複雜的元件，也可以是一個軟體。
一般來說</p></blockquote><h3 id=工作單元使用案例-use-case>工作單元、使用案例 Use Case</h3><blockquote><p>從呼叫系統的一個<strong>公開方法</strong>，到產生一個測試<strong>可見最終結果</strong>，在期間這個系統所發生的行為統稱為一個工作單元。</p></blockquote><p><strong>可見的最終結果</strong>可以是</p><ol><li>回傳值（如果公開方法有回傳值的話）</li><li>系統<strong>可見的</strong>狀態或行為改變，不需要查詢私有狀態就能取得。</li><li>呼叫一個不受測試所控制的第三方系統，這個第三方系統不回傳任何值或者回傳值不被系統使用。</li></ol><h3 id=單元測試-unit-test>單元測試 Unit Test</h3><blockquote><p>一個單元測試是一段自動化的程式碼，這段程式會呼叫被測試的工作單元，之後對這個單元的最終結果的某些假設或期望進行驗證。</p></blockquote><p><strong>特質</strong></p><blockquote><p>執行起來快速。可靠、易讀、並且很容易維護。只要產品程式碼不發生變化，單元測試的執行結果是穩定一致的。</p></blockquote><ul><li>自動化的，且可以被重複執行的。</li><li>容易被實現。</li><li>到第二天還有存在意義，非臨時性的。</li><li>任何人都可以按個按鈕執行它。</li><li>執行速度很快。</li><li>執行結果一致。</li><li>應該要能完全掌控受測單元。</li><li>完全被隔離的，獨立於其他測試。</li><li>如果執行結果失敗，能夠簡單清楚的呈現期望為何以及發生問題的原因在哪。</li></ul><h3 id=整合測試-integration-test>整合測試 Integration Test</h3><blockquote><p>對一個工作單元進行測試，而這個測試對被測試的單元並沒有完全的控制，而是使用該單元<strong>一個或多個真實依賴的相依物件</strong>，例如時間、網路、資料庫、執行緒或亂數產生器等等。</p></blockquote><p><strong>特徵</strong>：一次測試的東西太多。</p><h3 id=測試驅動開發-tdd>測試驅動開發 TDD</h3><pre><code>loop do
  撰寫符合期望的測試 - ( 紅燈 ) &gt; 撰寫或修改產品程式碼 -&gt; ( 綠燈 ) &gt; 重構 - ( 綠燈 )
end
</code></pre><h3 id=測試框架>測試框架</h3><p>框架是把重複做的東西，整理成好用的工具包，讓開發人員可以不用重新造車。而測試框架就是專門解決撰寫測試程式碼中重複的步驟，讓測試程式結構化、輕易執行所有測試以及協助確認結果。</p><h2 id=原則與建議>原則與建議</h2><h3 id=關於撰寫測試>關於撰寫測試</h3><ul><li>測試程式內部架構：準備 <strong>A</strong>rrange -> 操作 <strong>A</strong>ct -> 驗證 <strong>A</strong>ssert（3A）。</li><li>避免在 setup 中時做 Arrange 的步驟，3A 的測試程式碼應該靠進一點。（就像寫工作單元程式一樣）。</li><li>避免使用 Fixture 或者是在 teardown 中清理測試環境，這限制讓我們可以仔細思考，撰寫的測試是不是偏向整合測試，而不是單元測試。從而思考工作單元的設計和內部行為不夠獨立。除非是要重設 Shared Singleton 或某些常數。</li><li>測試程式的命名規則與一般程式命名規則不同，測試程式的命名重點在表達<strong>受測單元</strong>、<strong>測試情境</strong>以及<strong>期望結果</strong>。</li><li>善用參數化來簡化重複類似的測試程式。</li><li>測試程式的驗證目標應該是工作單元的三種可見的最終結果。</li><li>透過思考正向、反向以及例外三種情境來設計測試程式。</li></ul><p><strong>自我檢測</strong></p><ul><li>兩週前所寫的測試還能正常執行並得到結果嗎？</li><li>兩個月前撰寫的測試，團隊任何一個人都能正常執行它並得到結果嗎？</li><li>能在幾分鐘內跑完所有的單元測試嗎？</li><li>能一鍵執行所有寫過的單元測試嗎？</li><li>能在幾分鐘內寫出一個基本的單元測試嗎？</li></ul><p>答案應該都要是<strong>可以</strong>，才代表你在寫單元測試。
（某些部分有點武斷）</p><h3 id=關於工作單元>關於工作單元</h3><ul><li>不需要盡可能小，適當的大小可以讓測試更容易維護。（更傾向於維護商業邏輯的層面，有 BDD 的味道。）</li><li>小心過度指定（ overspecification ）。</li></ul><h3 id=關於很好的執行測試驅動開發-tdd>關於很好的執行測試驅動開發 TDD</h3><ol><li>善於撰寫優秀的測試。</li><li>在寫產品程式碼前先寫測試（避免過度理解工作單元的實作）。</li><li>良好的測試設計（涵蓋所有商業邏輯的情境）。</li></ol></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname===""){return;}
var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='jimytc-github-io';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the
<a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by
<span class=logo-disqus>Disqus</span></a></article></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-9646591-7','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script defer src=https://use.fontawesome.com/releases/v5.5.0/js/all.js integrity=sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0 crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js></script><script type=text/javascript>hljs.initHighlightingOnLoad();</script></body></html>