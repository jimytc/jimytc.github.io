<!doctype html><html lang=en><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="public"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.64.1"><title>Have Custom Attribute for a Rails ActiveRecord Model • Jim Chen</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Have Custom Attribute for a Rails ActiveRecord Model"><meta name=twitter:description content="Framework is pretty opinionated in its area, but that also means it handles many repetitive and tedious tasks. When using ORM like ActiveRecord, it saved us so much time defining which model has what attributes."><meta property="og:title" content="Have Custom Attribute for a Rails ActiveRecord Model"><meta property="og:description" content="Framework is pretty opinionated in its area, but that also means it handles many repetitive and tedious tasks. When using ORM like ActiveRecord, it saved us so much time defining which model has what attributes."><meta property="og:type" content="article"><meta property="og:url" content="https://jimytc.com/posts/2020/08/03/note_rails_active_records_attribute/"><meta property="article:published_time" content="2020-08-03T17:00:19+08:00"><meta property="article:modified_time" content="2020-08-03T17:00:19+08:00"><meta property="og:site_name" content="Backend Engineer"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css><link rel=stylesheet href=/scss/hyde-hyde.92c66d107d7b219f0792cfd67223179af884b03f386ac46894f9f735932bbca3.css integrity="sha256-ksZtEH17IZ8Hks/WciMXmviEsD84asRolPn3NZMrvKM="><link rel=stylesheet href=/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body class=theme-base-0a><div class=sidebar><div class=container><div class=sidebar-about><span class=site__title><a href=https://jimytc.com/>Jim Chen</a></span><div class=author-image><img src=https://jimytc.com/images/author-photo.png alt="Author Image" class="img--circle img--headshot element--center"></div><p class=site__description>a.k.a. jimytc</p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>Jim Chen</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=/posts/><span>Posts</span></a></li><li><a href=/tags/><span>Tags</span></a></li><li><a href=/categories/><span>Categories</span></a></li></ul></div><section class=social><a href=https://twitter.com/jimytc rel=me><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a><a href=https://facebook.com/jim.yenting rel=me><i class="fab fa-facebook-f"></i></a><a href=https://github.com/jimytc rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a><a href=https://instagram.com/jimytc rel=me><i class="fab fa-instagram fa-lg" aria-hidden=true></i></a><a href=https://linkedin.com/in/yentingchen rel=me><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a><a href=https://stackoverflow.com/users/2728942/jimytc rel=me><i class="fab fa-stack-overflow fa-lg" aria-hidden=true></i></a></section></div></div><div class=copyright>&copy; 2021 jimytc
<a href=https://creativecommons.org/licenses/by-sa/4.0>CC BY-SA 4.0</a></div><div class=builtwith>Built with <a href=https://gohugo.io>Hugo</a> ❤️ <a href=https://github.com/htr3n/hyde-hyde>hyde-hyde</a>.</div></div></div><div class="content container"><article><header><h1>Have Custom Attribute for a Rails ActiveRecord Model</h1><div class=post__meta><i class="fas fa-calendar-alt"></i>Aug 3, 2020
in
<a class="badge badge-category" href=/categories/engineering>ENGINEERING</a><br><i class="fas fa-tags"></i><a class="badge badge-tag" href=/tags/ruby>ruby</a>
<a class="badge badge-tag" href=/tags/ruby-on-rails>ruby on rails</a><br><i class="fas fa-clock"></i>3 min read</div></header><div class=post><p>Framework is pretty opinionated in its area, but that also means it handles many repetitive and tedious tasks. When using ORM like ActiveRecord, it saved us so much time defining which model has what attributes. The convention from ActiveRecord design is that all the columns of a table, which is a model in the app, are attributes of the model.</p><p>For example, let&rsquo;s imagine we have a User model and the table looks like below.
Please note that, the example below is not an ideal case but just an demonstration.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>desc</span> users;
<span style=color:#f92672>+</span><span style=color:#75715e>------------+--------------+------+-----+---------+----------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> Field      <span style=color:#f92672>|</span> <span style=color:#66d9ef>Type</span>         <span style=color:#f92672>|</span> <span style=color:#66d9ef>Null</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>Key</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>Default</span> <span style=color:#f92672>|</span> Extra          <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>------------+--------------+------+-----+---------+----------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> id         <span style=color:#f92672>|</span> int(<span style=color:#ae81ff>11</span>)      <span style=color:#f92672>|</span> <span style=color:#66d9ef>NO</span>   <span style=color:#f92672>|</span> PRI <span style=color:#f92672>|</span> <span style=color:#66d9ef>NULL</span>    <span style=color:#f92672>|</span> auto_increment <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> username   <span style=color:#f92672>|</span> varchar(<span style=color:#ae81ff>255</span>) <span style=color:#f92672>|</span> YES  <span style=color:#f92672>|</span> MUL <span style=color:#f92672>|</span> <span style=color:#66d9ef>NULL</span>    <span style=color:#f92672>|</span>                <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> first_name <span style=color:#f92672>|</span> varchar(<span style=color:#ae81ff>255</span>) <span style=color:#f92672>|</span> YES  <span style=color:#f92672>|</span>     <span style=color:#f92672>|</span> <span style=color:#66d9ef>NULL</span>    <span style=color:#f92672>|</span>                <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> last_name  <span style=color:#f92672>|</span> varchar(<span style=color:#ae81ff>255</span>) <span style=color:#f92672>|</span> YES  <span style=color:#f92672>|</span>     <span style=color:#f92672>|</span> <span style=color:#66d9ef>NULL</span>    <span style=color:#f92672>|</span>                <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>------------+--------------+------+-----+---------+----------------+
</span><span style=color:#75715e></span>
<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
<span style=color:#f92672>+</span><span style=color:#75715e>----+----------+------------+-----------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> id <span style=color:#f92672>|</span> username <span style=color:#f92672>|</span> first_name <span style=color:#f92672>|</span> last_name <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>----+----------+------------+-----------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span>  <span style=color:#ae81ff>3</span> <span style=color:#f92672>|</span> pfrank   <span style=color:#f92672>|</span> Paul       <span style=color:#f92672>|</span> Frank     <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>----+----------+------------+-----------+
</span></code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>ActiveRecord</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Base</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#f92672>&gt;</span> user <span style=color:#f92672>=</span> <span style=color:#66d9ef>User</span><span style=color:#f92672>.</span>find_by(id: <span style=color:#ae81ff>3</span><span style=color:#f92672></span>)
<span style=color:#75715e># SELECT * FROM users WHERE id = 3</span>

<span style=color:#f92672>&gt;</span> user<span style=color:#f92672>.</span>username
<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>pfrank</span><span style=color:#e6db74>&#34;</span>
</code></pre></div><p>If we want to access user&rsquo;s <code>full_name</code> which is sipmly composed by <code>first_name</code> and <code>last_name</code>, the most fastest way is just adding a new method with string concatenation since we&rsquo;ve have those attributes. So our <code>User</code> class becomes.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>ActiveRecord</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Base</span>

  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e></span><span style=color:#f92672></span><span style=color:#a6e22e>full_name</span>
    <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>#{</span>first_name<span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>#{</span>last_name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#f92672>&gt;</span> user<span style=color:#f92672>.</span>full_name
<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>Paul Frank</span><span style=color:#e6db74>&#34;</span>
</code></pre></div><p>But&mldr; we could do this with database query too, right?</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>, CONCAT_WS(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74> </span><span style=color:#e6db74>&#39;</span>, first_name, last_name) <span style=color:#66d9ef>AS</span> full_name <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
<span style=color:#f92672>+</span><span style=color:#75715e>----+----------+------------+-----------+------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> id <span style=color:#f92672>|</span> username <span style=color:#f92672>|</span> first_name <span style=color:#f92672>|</span> last_name <span style=color:#f92672>|</span> full_name  <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>----+----------+------------+-----------+------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span>  <span style=color:#ae81ff>3</span> <span style=color:#f92672>|</span> pfrank   <span style=color:#f92672>|</span> Paul       <span style=color:#f92672>|</span> Frank     <span style=color:#f92672>|</span> Paul Frank <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>----+----------+------------+-----------+------------+
</span></code></pre></div><p>If we want to have <code>full_name</code> calculated in our database query, we could use <code>attribute</code> to define it, then use the query to have the value being mapped from the query result.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>ActiveRecord</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Base</span>
  scope <span style=color:#e6db74>:will_full_name</span>, <span style=color:#f92672>-</span><span style=color:#f92672>&gt;</span> { select(<span style=color:#e6db74>&#39;`*`, CONCAT_WS(&#39;</span> <span style=color:#e6db74>&#39;, `first_name`, `last_name`)&#39;</span>)}
  attribute <span style=color:#e6db74>:full_name</span>, <span style=color:#e6db74>:string</span>, <span style=color:#e6db74>default</span>: <span style=color:#66d9ef>nil</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>User</span><span style=color:#f92672>.</span>with_full_name<span style=color:#f92672>.</span>where(id: <span style=color:#ae81ff>3</span><span style=color:#f92672></span>)<span style=color:#f92672>.</span>take
<span style=color:#f92672>&gt;</span> user<span style=color:#f92672>.</span>full_name
<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>Paul Frank</span><span style=color:#e6db74>&#34;</span>
</code></pre></div><p>Yeah, the above example looks over-engineered, because it&rsquo;s actually simpler with the first implementation. However, this could help if the data we stored can only be calculated in the database or the processing is much simpler and faster in database level.</p><hr><p>The use of <code>attribute</code> is not just the case above. It&rsquo;s even more powerful than it. Please refer to the <a href=https://edgeapi.rubyonrails.org/classes/ActiveRecord/Attributes/ClassMethods.html>official API document</a> for it.</p></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname===""){return;}
var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='jimytc-github-io';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the
<a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by
<span class=logo-disqus>Disqus</span></a></article></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-9646591-7','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script defer src=https://use.fontawesome.com/releases/v5.5.0/js/all.js integrity=sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0 crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js></script><script type=text/javascript>hljs.initHighlightingOnLoad();</script></body></html>